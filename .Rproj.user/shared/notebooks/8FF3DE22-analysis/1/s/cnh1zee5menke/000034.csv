"0",""
"0","library(npsurvival)"
"0","library(data.table)"
"0","library(assertthat)"
"0","# relevant variables"
"0","subset_region <- ""la"""
"0","weights_twostage <- ""wt.D29"" #""wt.D29start1"""
"0","covariates <- c(""standardized_risk_score"", ""Sex"") #c(""HighRiskInd"", ""Sex"", ""age.geq.65"",""standardized_risk_score"")"
"0","failure_time <- ""EventTimePrimaryD29"""
"0","event_type <- ""EventIndPrimaryMolecConfirmedD29"""
"0","viral_load <- ""seq1.log10vl"""
"0","marker <- paste0(""Day29pseudoneutid50"", subset_region)"
"0","variant_type <- ""seq1.variant.hotdeck1"""
"0","Perprotocol <- ""Perprotocol""    "
"0","TwophasesampIndD29 <- ""TwophasesampIndD29"""
"0","Trt <- ""Trt"""
"0","# get data"
"0","data <- setDT(fread(paste0(""data/janssen_"", subset_region, ""_partA_data_processed_with_riskscore_hotdeckv4.csv"")))"
"0","subset <- which(data[[Perprotocol]] == 1)"
"0","data <- data[subset]"
"0","# subset vaccine and placebo arm, per protocol, and in phase-two-sample (for day 29 marker)"
"0","#sum(is.na(data$seq1.variant.hotdeck5[data$Trt == 1 & !is.na(data$wt.D29) &  !is.na(data$EventIndPrimaryMolecConfirmedD29) & data$EventIndPrimaryMolecConfirmedD29 == 1]))"
"0","# sum(is.na(data$seq1.variant.hotdeck5[data$Trt == 0 & !is.na(data$EventIndPrimaryMolecConfirmedD29) & data$EventIndPrimaryMolecConfirmedD29 == 1]))"
"0"," "
"0"," "
"0"," "
"0",""
"0","data <- data[, c(weights_twostage, marker, event_type, failure_time, covariates, variant_type, Perprotocol, TwophasesampIndD29, Trt , viral_load, ""EventIndPrimaryD29""), with = FALSE]"
"0","# make competing risk indicators"
"0","variant_strata <- c(""Ancestral.Lineage"" = 181 ,"
"0","                           ""Zeta"" = 176,"
"0","                           ""Lambda"" = 77,"
"0","                           ""Mu"" = 175,"
"0","                           ""Gamma"" = 181"
"0","                           )"
"0","variant_names <- names(variant_strata)"
"0","for(variant in variant_names) {"
"0","  event_type_key <- paste0(event_type, ""_"", variant )"
"0","  value <- data[[event_type]]"
"0","  value[is.na(value)] <- -1"
"0","  value[!is.na(value) & value==1] <- ifelse(data[[variant_type]][!is.na(value) & value==1] == variant, 1, 2)"
"0","  # Any remaining NAS are assigned a competing risk"
"0","  value[value == -1] <- NA"
"0","  value[is.na(value)] <- 2"
"0","  data[, (event_type_key) := value]"
"0","}"
"0","head(data)"
