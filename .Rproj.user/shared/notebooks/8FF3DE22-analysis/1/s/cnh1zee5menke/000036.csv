"0",""
"0",""
"0","# specify variant"
"0","variant <- variant_names[[1]]"
"0","# use competing weights"
"0","weights <- weights_twostage"
"0",""
"0","# Run competing risk analysis"
"0","tf <- variant_strata[paste0(variant)]"
"0","event_type_target <- paste0(event_type, ""_"", variant)"
"0","# for CR only, remove observations without variant information"
"0","#if(event_type != event_type_target) {"
"0"," # data <- data[!is.na(data[[variant_type]])]"
"0","#}"
"0"," "
"0","# make datasets of placebo and treated analysis"
"0","subset_treated <- data[[Trt]]==1"
"0","data_placebo <- data[!subset_treated]"
"0","data_treated <- data[subset_treated]"
"0","subset <- which(data_treated[[TwophasesampIndD29]] == 1)"
"0","data_treated <- data_treated[subset]  # assumes TwophasesampIndD29 used only for treatment arm"
"0","# subset to reelvant variables"
"0","data_treated <- data_treated[, c(covariates, failure_time, event_type_target, marker, weights), with = FALSE]"
"0","data_placebo <-  data_placebo[, c(covariates, failure_time, event_type_target), with = FALSE]"
"0","assert_that(all("
"0","  data_treated$Trt == 1 "
"0","  & data_treated$Perprotocol == 1"
"0","  & data_treated$TwophasesampIndD29 == 1"
"0","  & !any(is.na(data_treated[[variant_type]]))"
"0","))"
"1","[1]"
"1"," TRUE"
"1","
"
"0","assert_that(all("
"0","  data_placebo$Trt == 0 "
"0","  & data_placebo$Perprotocol == 1"
"0","  & data_placebo$TwophasesampIndD29 == 1"
"0","  & !any(is.na(data_placebo[[variant_type]]))"
"0","))"
"1","[1]"
"1"," TRUE"
"1","
"
"0"," "
"0"," "
"0","#### Analysis for treated"
"0","## get reference time for survival analysis"
"0","output_treated <- run_analysis(tf = tf, "
"0","             data_surv = data_treated, "
"0","             covariates = covariates, "
"0","             failure_time = failure_time,"
"0","             event_type = event_type_target, "
"0","             weights = weights, "
"0","             marker = marker,"
"0","             nbins_time = 20,"
"0","             nbins_threshold = 20)"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00987161041390066"""
"1","
"
"1","[1]"
"1"," -6.315432e-18"
"1","
"
"1","[1]"
"1"," 46"
"1","
"
"1","[1]"
"1"," 0.0004135989"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00541453092702836"""
"1","
"
"1","[1]"
"1"," -6.317891e-17"
"1","
"
"1","[1]"
"1"," 48"
"1","
"
"1","[1]"
"1"," 0.0004599562"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00483444059707534"""
"1","
"
"1","[1]"
"1"," -8.870774e-17"
"1","
"
"1","[1]"
"1"," 48"
"1","
"
"1","[1]"
"1"," 0.0004773578"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00495543804682036"""
"1","
"
"1","[1]"
"1"," -1.745762e-17"
"1","
"
"1","[1]"
"1"," 50"
"1","
"
"1","[1]"
"1"," 0.0004769149"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.0049712759086206"""
"1","
"
"1","[1]"
"1"," -2.031857e-18"
"1","
"
"1","[1]"
"1"," 50"
"1","
"
"1","[1]"
"1"," 0.00068139"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.0051071671750889"""
"1","
"
"1","[1]"
"1"," -6.700227e-14"
"1","
"
"1","[1]"
"1"," 50"
"1","
"
"1","[1]"
"1"," 0.0004905902"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00513208896465942"""
"1","
"
"1","[1]"
"1"," -1.925997e-16"
"1","
"
"1","[1]"
"1"," 54"
"1","
"
"1","[1]"
"1"," 0.0006087294"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00481243012207588"""
"1","
"
"1","[1]"
"1"," -4.71533e-19"
"1","
"
"1","[1]"
"1"," 53"
"1","
"
"1","[1]"
"1"," 0.0005440149"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00542833097799821"""
"1","
"
"1","[1]"
"1"," -1.936475e-14"
"1","
"
"1","[1]"
"1"," 53"
"1","
"
"1","[1]"
"1"," 0.0005326075"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00841592359447713"""
"1","
"
"1","[1]"
"1"," -1.089843e-13"
"1","
"
"1","[1]"
"1"," 53"
"1","
"
"1","[1]"
"1"," 0.0002894876"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00793973390309142"""
"1","
"
"1","[1]"
"1"," -2.225194e-12"
"1","
"
"1","[1]"
"1"," 63"
"1","
"
"1","[1]"
"1"," 0.0004701157"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00720096093641065"""
"1","
"
"1","[1]"
"1"," 8.647763e-20"
"1","
"
"1","[1]"
"1"," 55"
"1","
"
"1","[1]"
"1"," 0.0003669787"
"1","
"
"0","# make survival dataset"
"0"," "
"0"," output_treated$estimates <- unlist( output_treated$estimates )"
"0","  output_treated$times <- unlist( output_treated$times )"
"0","  output_treated"
