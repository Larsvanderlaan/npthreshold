"0",""
"0",""
"0","# specify variant"
"0","variant <- variant_names[[1]]"
"0","# use competing weights"
"0","weights <- weights_twostage"
"0",""
"0","# Run competing risk analysis"
"0","tf <- variant_strata[paste0(variant)]"
"0","event_type_target <- paste0(event_type, ""_"", variant)"
"0","# for CR only, remove observations without variant information"
"0","#if(event_type != event_type_target) {"
"0"," # data <- data[!is.na(data[[variant_type]])]"
"0","#}"
"0"," "
"0","# make datasets of placebo and treated analysis"
"0","subset_treated <- data[[Trt]]==1"
"0","data_placebo <- data[!subset_treated]"
"0","data_treated <- data[subset_treated]"
"0","subset <- which(data_treated[[TwophasesampIndD29]] == 1)"
"0","data_treated <- data_treated[subset]  # assumes TwophasesampIndD29 used only for treatment arm"
"0","# subset to reelvant variables"
"0","data_treated <- data_treated[, c(covariates, failure_time, event_type_target, marker, weights), with = FALSE]"
"0","data_placebo <-  data_placebo[, c(covariates, failure_time, event_type_target), with = FALSE]"
"0","assert_that(all("
"0","  data_treated$Trt == 1 "
"0","  & data_treated$Perprotocol == 1"
"0","  & data_treated$TwophasesampIndD29 == 1"
"0","  & !any(is.na(data_treated[[variant_type]]))"
"0","))"
"1","[1]"
"1"," TRUE"
"1","
"
"0","assert_that(all("
"0","  data_placebo$Trt == 0 "
"0","  & data_placebo$Perprotocol == 1"
"0","  & data_placebo$TwophasesampIndD29 == 1"
"0","  & !any(is.na(data_placebo[[variant_type]]))"
"0","))"
"1","[1]"
"1"," TRUE"
"1","
"
"0"," "
"0"," "
"0","#### Analysis for treated"
"0","## get reference time for survival analysis"
"0","output_treated <- run_analysis(tf = tf, "
"0","             data_surv = data_treated, "
"0","             covariates = covariates, "
"0","             failure_time = failure_time,"
"0","             event_type = event_type_target, "
"0","             weights = weights, "
"0","             marker = marker,"
"0","             nbins_time = 20,"
"0","             nbins_threshold = 20)"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00980356891544032"""
"1","
"
"1","[1]"
"1"," -7.623772e-18"
"1","
"
"1","[1]"
"1"," 45"
"1","
"
"1","[1]"
"1"," 0.000447948"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00546900534570792"""
"1","
"
"1","[1]"
"1"," -4.155179e-17"
"1","
"
"1","[1]"
"1"," 50"
"1","
"
"1","[1]"
"1"," 0.0005842783"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00548865249672227"""
"1","
"
"1","[1]"
"1"," -4.609661e-17"
"1","
"
"1","[1]"
"1"," 49"
"1","
"
"1","[1]"
"1"," 0.0006532977"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00514122313100437"""
"1","
"
"1","[1]"
"1"," -2.100245e-18"
"1","
"
"1","[1]"
"1"," 54"
"1","
"
"1","[1]"
"1"," 0.0005284335"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.00483501531222149"""
"1","
"
"1","[1]"
"1"," -1.281181e-17"
"1","
"
"1","[1]"
"1"," 49"
"1","
"
"1","[1]"
"1"," 0.0006127833"
"1","
"
"1","[1]"
"1"," ""Estimating propensity score for treatment mechanism... """
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for failure mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional hazard function for censoring mechanism..."""
"1","
"
"1","[1]"
"1"," ""Estimating conditional distribution for failure type mechanism..."""
"1","
"
"1","[1]"
"1"," ""ests: 0.0054827696493106"""
"1","
"
"1","[1]"
"1"," -7.00032e-15"
"1","
"
